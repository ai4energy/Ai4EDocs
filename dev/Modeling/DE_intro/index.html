<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>DifferentialEquations建模方法 · Ai4EDocs</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/css/ai4e.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="Ai4EDocs logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Ai4EDocs</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Modeling</span><ul><li class="is-active"><a class="tocitem" href>DifferentialEquations建模方法</a><ul class="internal"><li><a class="tocitem" href="#浅谈建模内涵"><span>浅谈建模内涵</span></a></li><li><a class="tocitem" href="#DE使用实例"><span>DE使用实例</span></a></li><li><a class="tocitem" href="#DE的Callback特性"><span>DE的Callback特性</span></a></li></ul></li><li><a class="tocitem" href="../MTK_intro/">ModelingToolkit建模方法</a></li><li><a class="tocitem" href="../MTK_register/">ModelingToolkit调用外部函数</a></li><li><a class="tocitem" href="../MTK_tips/">MTK常见问题</a></li><li><a class="tocitem" href="../ModelingTutorial/">组织方程的艺术——组件化（入门）</a></li><li><a class="tocitem" href="../WathMTKdo/">MTK的&quot;前世今生&quot;</a></li><li><a class="tocitem" href="../neural_network/">数学视角下的神经网络</a></li></ul></li><li><span class="tocitem">Simulation</span><ul><li><a class="tocitem" href="../../Simulation/DE_heattran/">DE求解PDE（对比MTK）</a></li><li><a class="tocitem" href="../../Simulation/MTK_heattran/">MTK手动空间离散求解PDE</a></li><li><a class="tocitem" href="../../Simulation/componementModel/">组件化建模实例</a></li><li><a class="tocitem" href="../../Simulation/steadyRC/">MTK稳态系统仿真实例</a></li></ul></li><li><span class="tocitem">Optimization</span><ul><li><a class="tocitem" href="../../Optimization/DE_Estim/">微分方程参数辨识实例</a></li><li><a class="tocitem" href="../../Optimization/JuMP参数辨识/">JuMP非线性参数辨识实例</a></li><li><a class="tocitem" href="../../Optimization/JumpMILP/">JuMP混合整数线性优化实例</a></li><li><a class="tocitem" href="../../Optimization/systemParaEste/">MTK符号系统参数辨识</a></li><li><a class="tocitem" href="../../Optimization/systemParaEste_batter/">MTK部分参数辨识实例</a></li><li><a class="tocitem" href="../../Optimization/参数辨识实例_MTK/">MTK非线性参数辨识实例</a></li></ul></li><li><span class="tocitem">Control</span><ul><li><a class="tocitem" href="../../Control/JuMPMPC/">JuMP求解MPC问题</a></li><li><a class="tocitem" href="../../Control/KalmanFiltering/">卡尔曼滤波理论与应用</a></li><li><a class="tocitem" href="../../Control/MTKMPC/">MTK求解MPC问题</a></li><li><a class="tocitem" href="../../Control/OptimControl/">最优控制理论与应用</a></li></ul></li><li><span class="tocitem">Frameworks</span><ul><li><a class="tocitem" href="../../Frameworks/Ai4EComponentLib/">Ai4EComponentLib.jl设计理念</a></li><li><a class="tocitem" href="../../Frameworks/OptControl/">OptControl.jl设计理念</a></li></ul></li><li><span class="tocitem">CSBase</span><ul><li><a class="tocitem" href="../../CSBase/1-Windows命令提示符介绍/">Windows的命令提示符简介</a></li><li><a class="tocitem" href="../../CSBase/2-PowerShell和WindowsTerminal/">PowerShell和Windows Terminal</a></li><li><a class="tocitem" href="../../CSBase/3-环境变量及其设置/">环境变量简介</a></li><li><a class="tocitem" href="../../CSBase/4-Windows下安装gcc编译器和CLion/">Windows下安装gcc编译器和CLion</a></li><li><a class="tocitem" href="../../CSBase/5-make和Makefile介绍/">make和Makefile介绍</a></li><li><a class="tocitem" href="../../CSBase/6-静态链接库和动态链接库/">静态链接库和动态链接库</a></li><li><a class="tocitem" href="../../CSBase/7-以SAM为例整体实操一下/">以SAM为例实操</a></li><li><a class="tocitem" href="../../CSBase/Creat and Call dll/">动态链接库(DLL)的生成与调用</a></li><li><a class="tocitem" href="../../CSBase/SSH_Git/">SSH、Git与Git图形化软件</a></li><li><a class="tocitem" href="../../CSBase/env_variable/">环境（变量）的本质</a></li></ul></li><li><span class="tocitem">Tools</span><ul><li><a class="tocitem" href="../../Tools/CSV_jl_use/">CSV.jl使用简介</a></li><li><a class="tocitem" href="../../Tools/CoolProp/">CoolProp使用介绍</a></li><li><a class="tocitem" href="../../Tools/vscode_git/">VScode中使用Git</a></li></ul></li><li><span class="tocitem">WorkFlow</span><ul><li><a class="tocitem" href="../../WorkFlow/ julia-binary-wrappers/">julia对外部程序的加壳</a></li><li><a class="tocitem" href="../../WorkFlow/DocStructure/">文档（docs）编写方法</a></li><li><a class="tocitem" href="../../WorkFlow/REPL-of-Julia/">julia 的 REPL</a></li><li><a class="tocitem" href="../../WorkFlow/gitworkflow/">Ai4E组织合作开发流程</a></li><li><a class="tocitem" href="../../WorkFlow/julia-call-c7fortran/">julia调用dll中的函数</a></li><li><a class="tocitem" href="../../WorkFlow/julia_change_pkgserve/">Julia换源(更换国内镜像站)</a></li><li><a class="tocitem" href="../../WorkFlow/julia的安装/">Julia安装</a></li><li><a class="tocitem" href="../../WorkFlow/vscodePlugin/">VScode开发环境配置</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Modeling</a></li><li class="is-active"><a href>DifferentialEquations建模方法</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>DifferentialEquations建模方法</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ai4energy/Ai4EDocs/blob/main/docs/src/Modeling/DE_intro.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="DifferentialEquations建模方法"><a class="docs-heading-anchor" href="#DifferentialEquations建模方法">DifferentialEquations建模方法</a><a id="DifferentialEquations建模方法-1"></a><a class="docs-heading-anchor-permalink" href="#DifferentialEquations建模方法" title="Permalink"></a></h1><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>Contents：建模、DE</p><p>Contributor: YJY</p><p>Email:522432938@qq.com</p><p>如有错误，请批评指正。</p></div></div><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>DE = DifferentialEquations.jl</p><p><a href="https://diffeq.sciml.ai/dev/">DifferentialEquations.jl</a>为处理时间微分的求解建模工具包。</p></div></div><h2 id="浅谈建模内涵"><a class="docs-heading-anchor" href="#浅谈建模内涵">浅谈建模内涵</a><a id="浅谈建模内涵-1"></a><a class="docs-heading-anchor-permalink" href="#浅谈建模内涵" title="Permalink"></a></h2><p>在研究各类系统时（上至电力、能源系统、交通系统，下至RC电路、水利管网系统），当我们需要对系统进行处理时，我们都会一件相同的事情——把系统抽象成我们能够处理的对象！</p><p>从发现问题到获得计算结果，在现代计算科学中一般分为两步：</p><ol><li>把问题抽象可量化、可处理的数学问题</li><li>把数学问题设计成可用计算机处理与计算的可计算问题</li></ol><p>在这个过程中，大脑在这个过程充当了“解释器”的角色。把实际的问题层层抽象，最后让问题变得可计算。不得不感叹，人类“编译”能力之强大。也许人类在计算速度上远远不及计算机。但在深度与广度层面，远远超过计算机。</p><p>从前牛顿等巨人的时代开始，科学家研究的主体内容，主要是是第一步的内容。近40年，计算机科学技术呈爆炸式增长。依托于计算机，社会生产的智能化日益提高。于是基于第2步的问题也发展出许多学科分支，作为科研领域重要的方向之一。</p><p>这是一件很奇妙的事情，巨量1与0的加减运算产生了无穷的能力！就好像神经元虽然简单，只要数量够，也能组合成产生无数想法的大脑！</p><p>言归正传，在第一步中，描述对象的数学形式有微分方程（组）、代数方程（组）、图等等。针对对象进行计算的数学形式有求解方程问题、寻优问题、计算图等等。DifferentialEquations.jl就是处理基于时间微分的微分方程（组）求解软件包！</p><h2 id="DE使用实例"><a class="docs-heading-anchor" href="#DE使用实例">DE使用实例</a><a id="DE使用实例-1"></a><a class="docs-heading-anchor-permalink" href="#DE使用实例" title="Permalink"></a></h2><p>现有洛伦兹方程为例：</p><p class="math-container">\[\frac{dx}{dt}  = \sigma(y-x) \\ \frac{dy}{dt}  = x(\rho-z)-y \\ \frac{dz}{dt} = xy - \beta z\]</p><p>微分方程在DifferentialEquations.jl中含有5个要素：</p><ul><li>方程描述</li><li>求解时间域</li><li>初值（边界条件）</li><li>方程参数</li><li>问题类型</li></ul><hr/><p>在方程定义中，有4个参数：</p><pre><code class="language-julia hljs">function lorenz!(du,u,p,t)
    du[1] = p[1]*(u[2]-u[1])
    du[2] = u[1]*(p[2]-u[3]) - u[2]
    du[3] = u[1]*u[2] - p[3]*u[3]
end</code></pre><p>其中，</p><ul><li>du为微分变量向量</li><li>u为变量向量</li><li>p为参数</li><li>t为时间变量</li></ul><hr/><p>剩下要素的定义：</p><pre><code class="language-julia hljs">p = [10.0,28.0,8/3]
u0 = [1.0;0.0;0.0]
tspan = (0.0,100.0)
prob = ODEProblem(lorenz!,u0,tspan,p)</code></pre><p>其中，</p><ul><li>p为参数</li><li>u0变量的初始值</li><li>tspan为求解时间域</li><li>prob为通过方法ODEProblem()定义的ODE问题</li></ul><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>ODEProblem = Ordinary Differential Equations Problem(常微分方程)</p><p class="math-container">\[\begin{array}{l}
\frac{d x}{d t}=\sigma(y-x) \\
\frac{d y}{d t}=x(\rho-z)-y \\
\frac{d z}{d t}=x y-\beta z
\end{array}\]</p><p>除此之外，还有：</p><p>DAEProblem = Differential Algebraic Equations Problem（微分代数方程）</p><p class="math-container">\[\begin{aligned}\frac{d y_{1}}{d t} &amp;=-0.04 y_{1}+10^{4} y_{2} y_{3} \\\frac{d y_{2}}{d t} &amp;=0.04 y_{1}-10^{4} y_{2} y_{3}-3 * 10^{7} y_{2}^{2} \\1 &amp;=y_{1}+y_{2}+y_{3}\end{aligned}\]</p><p>DDEProblem = Delay Differential Equations Problem（随机微分）</p><p class="math-container">\[\begin{aligned}
d x_{0} &amp;=\frac{v_{0}}{1+\beta_{0}\left(x_{2}(t-\tau)\right)^{2}}\left(p_{0}-q_{0}\right) x_{0}(t)-d_{0} x_{0}(t) \\d x_{1} &amp;=\frac{v_{0}}{1+\beta_{0}\left(x_{2}(t-\tau)\right)^{2}}\left(1-p_{0}+q_{0}\right) x_{0}(t) \\&amp;+\frac{v_{1}}{1+\beta_{1}\left(x_{2}(t-\tau)\right)^{2}}\left(p_{1}-q_{1}\right) x_{1}(t)-d_{1} x_{1}(t) \\d x_{2} &amp;=\frac{v_{1}}{1+\beta_{1}\left(x_{2}(t-\tau)\right)^{2}}\left(1-p_{1}+q_{1}\right) x_{1}(t)-d_{2} x_{2}(t)\end{aligned}\]</p><p>更多方程种类可查官方文档。</p></div></div><hr/><p>求解并画图</p><pre><code class="language-julia hljs">sol = solve(prob, Tsit5())
plot(sol,vars=(1,2,3))</code></pre><p><img src="../../assets/DE_intro-17_17_29.png" alt="图 4"/>  </p><p>全部代码：</p><pre><code class="language-julia hljs">using DifferentialEquations,Plots
function lorenz!(du,u,p,t)
        du[1] = p[1]*(u[2]-u[1])
        du[2] = u[1]*(p[2]-u[3]) - u[2]
        du[3] = u[1]*u[2] - p[3]*u[3]
end
p = [10.0,28.0,8/3]
u0 = [1.0;0.0;0.0]
tspan = (0.0,100.0)
prob = ODEProblem(lorenz!,u0,tspan,p)
sol = solve(prob, Tsit5())
plot(sol,vars=(1,2,3))</code></pre><hr/><h2 id="DE的Callback特性"><a class="docs-heading-anchor" href="#DE的Callback特性">DE的Callback特性</a><a id="DE的Callback特性-1"></a><a class="docs-heading-anchor-permalink" href="#DE的Callback特性" title="Permalink"></a></h2><p>Callback的含义为，当系统运行到某个状态时，人为介入改变系统参量的值，随后继续求解。</p><p>下面以弹球系统为例，介绍Callback的用法。</p><p>弹球系统的特点是，当弹球碰到地面时，需要弹起。所以在模拟弹球系统时，需要考虑求解过程中速度的方法变化，这时候就用到callback。碰地的数学的描述为，弹球速度变量变为它的相反数。也就是说当弹球高度<span>$x$</span>变为0时，速度<span>$u$</span>需要变成<span>$-u$</span>。</p><p>其数学表达为：</p><p class="math-container">\[x&#39; = v \\ v&#39; = -g\]</p><hr/><p>DE问题构建：</p><pre><code class="language-julia hljs">function f(du,u,p,t)
    du[1] = u[2]
    du[2] = -p
end</code></pre><p>其中，</p><ul><li>u1为x，即弹球高度</li><li>u2为v，即弹球速度</li></ul><hr/><p>建立Callback函数：</p><pre><code class="language-julia hljs">function condition(u,t,integrator) # Event when event_f(u,t) == 0
    u[1]
end
function affect!(integrator)
integrator.u[2] = -integrator.u[2]
end
cb = ContinuousCallback(condition,affect!)</code></pre><p><code>condition</code>为系统调用callback时应该满足的条件，默认为函数返回值为0（false）时的情况。即<code>u[1]=0</code>。 <code>affect!</code>为系统调用callback时的处理动作，这里为将速度变负。</p><hr/><p>定义剩余要素并求解，<strong>在solve中需要传递callback</strong>。</p><pre><code class="language-julia hljs">u0 = [50.0,0.0]
tspan = (0.0,15.0)
p = 9.8
prob = ODEProblem(f,u0,tspan,p)
sol = solve(prob,Tsit5(),callback=cb)
plot(sol)</code></pre><p>可以得到如下结果：</p><p><img src="../../assets/DE_intro-17_31_12.png" alt="图 5"/></p><hr/><p>如果考虑反弹损失（每次反弹速度损失20%）：</p><pre><code class="language-julia hljs">function affect!(integrator)
integrator.u[2] = -integrator.u[2]*0.8
end</code></pre><p><img src="../../assets/DE_intro-17_32_22.png" alt="图 6"/>  </p><p>也能够得到相应的结果，妙啊！！！</p><p>全部代码：</p><pre><code class="language-julia hljs">using DifferentialEquations,Plots
function f(du, u, p, t)
    du[1] = u[2]
    du[2] = -p
end
function condition(u, t, integrator) # Event when event_f(u,t) == 0
    u[1]
end
function affect!(integrator)
    integrator.u[2] = -integrator.u[2]
end
cb = ContinuousCallback(condition, affect!)
u0 = [50.0, 0.0]
tspan = (0.0, 15.0)
p = 9.8
prob = ODEProblem(f, u0, tspan, p)
sol = solve(prob, Tsit5(), callback=cb)
plot(sol)</code></pre><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>DE中有许多特性，例如求解结果的处理（Solution Handle）、回调函数（Callback）等等。更多特性可以在官方文档中查看。</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../MTK_intro/">ModelingToolkit建模方法 »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Sunday 2 July 2023 14:55">Sunday 2 July 2023</span>. Using Julia version 1.9.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
